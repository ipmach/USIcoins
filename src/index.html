<!DOCTYPE html>
<html lang="en">
<head>
      <title>USI COIN</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="index.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <style>
  .fakeimg {
    height: 200px;
    background: #aaa;
  }
  </style>
</head>

<div id="ini" class="jumbotron text-center" style="margin-bottom:0">
    <img id="logo" src="img.png" alt="Italian Trulli">

    <h1>Welcome to the official app of USICOIN</h1>
    <p>USICOIN is an app run in the etherum network to help
        the students in this time of need.</p>
</div>


<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <a class="navbar-brand" href="#">Options</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
        <li class="nav-item">
        <a class="nav-link" href="#Profile">Profile</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#ReserveRoom">Reserve room</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#USIpoints">Give usi points</a>
      </li>
        <li class="nav-item">
        <a class="nav-link" href="#About">About</a>
      </li>
        <li class="nav-item">
        <a class="nav-link" href="#QA">Q&A</a>
      </li>
    </ul>
  </div>
</nav>
<div id="Profile" class="container-fluid">
<h2 class ="sh2">Profile</h2>
    <p>Here you can see your use data: </p>
      <table id="table_profile" class="table">
    <thead>
      <tr>
        <th>User</th>
        <th>Info</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><b>Name</b></td>
        <td>Name_user</td>
      </tr>
      <tr>
        <td><b>Last name</b></td>
        <td>last_name</td>
      </tr>
      <tr>
        <td><b>Study</b></td>
        <td>study</td>
      </tr>
      <tr>
        <td><b>Balance</b></td>
        <td>0</td>
      </tr>
    </tbody>
  </table>
    <div class="FormClass" id="Form">
        <p> <b> Create you user:</b> </p>
        <label for="fname">Name:     </label>
        <input type="text" id="fname" name="fname"><br>
        <label for="fname2">Last name:</label>
        <input type="text" id="fname2" name="fname2"><br>
        <label for="fname3">Studies:  </label>
        <input type="text" id="fname3" name="fname3"><br>
        <button type="button" class="btn btn-secondary" onclick=button_register()>Register</button>
    </div>
    <p> </p>
</div>
<div id="ReserveRoom" class="container-fluid">
<h2 class ="sh2">Reserve Room</h2>
    <table id = "Reserve" width="100%">
        <thead>
            <tr>
                <th>Room</th>
                <th>Open hour</th>
                <th>Close Hour</th>
                <th>Index</th>
            </tr>

        </thead>
        <tbody id = "ReserveB">

        </tbody>

    </table>
    <div class="FormClass" id="Form_reserve">
        <label for="rname1">Index room:  </label>
        <input type="text" id="rname1" name="fname2"><br>
        <label for="rname2">Hour:  </label>
        <input type="text" id="rname2" name="fname3"><br>
        <button type="button" class="btn btn-secondary" onclick=button_reserve()>Reserve</button>
    </div>
</div>
<div id="USIpoints" class="container-fluid">
<h2 class ="sh2">USI points</h2>
    <label for="fname">Payee Address:</label>
    <input type="text" id="address" name="fname">
    <input type="submit" value="Send">
</div>
<div id="About" class="container-fluid">
    <h2 class ="sh2">ABOUT</h2>
    <p> Because of corona students have limited places to study, so our team decide to try
    to solve this problem with a descentralize app power by ethererum. The idea is to ensure
        that every student at least can use the university space for a few hours per week. </p>
    <p>To be able to acomplish this we create a market with USICOINS, a selfregularize market,
    where every students get new points each week that can be use to reserve study areas in the university.</p>
     <img id="logo2" src="img2.png" alt="Italian Trulli">
</div>
    <div id="QA" class="container-fluid">
    <h2 class ="sh2">Q&A</h2>
    <p> <b>Is save to use this coins? </b> </p>
    Yes, all the operations are done in one of the bigger blockchain in the planet, secure and anonymous.
    <p> </p>
    <p> <b>What do I need to use it? </b> </p>
    Well, an ethereum account, we recommend use Metamask for that. After that you need to put some data in the app,
    but nothing special.
    <p> </p>
    <p> <b>Is this free? </b> </p>
    USICOINS are a non profit exchange coin. We understand that students are having a difficult time this days so you
    don't have to use real money. But if you want, you can buy eth and use it in other apps in the ethereum network.
    <p> </p>
    <p> <b>Is this app already finish? </b> </p>
    Well, we are in demo right now. First we want to obtain peoples feedback.
    <p> </p>
    <p> <b>Who made this app? </b> </p>
    Is done by students, to students, for students.
</div>

    <script>
        document.getElementById("dropdownMenuButton").onclick = function() {myFunction()};

        function myFunction() {
        var e = document.getElementById("dropdownMenuButton").value;
        console.log(e);
        //var strUser =e.options[e.target.selectedIndex].text;
        //e.innerHTML = strUser;
    }
    </script>

    <script>
        abi = [
    {
      "payable": true,
      "stateMutability": "payable",
      "type": "fallback"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "string",
          "name": "_firstName",
          "type": "string"
        },
        {
          "internalType": "string",
          "name": "_lastName",
          "type": "string"
        },
        {
          "internalType": "string",
          "name": "_study",
          "type": "string"
        }
      ],
      "name": "addPerson",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "string",
          "name": "_name",
          "type": "string"
        },
        {
          "internalType": "uint256",
          "name": "_open_hour",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "_close_hour",
          "type": "uint256"
        },
        {
          "internalType": "int256",
          "name": "_number_people",
          "type": "int256"
        }
      ],
      "name": "add_class",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [],
      "name": "get_balance",
      "outputs": [
        {
          "internalType": "int256",
          "name": "",
          "type": "int256"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        }
      ],
      "name": "get_closeHour_room",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "close_hour",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [],
      "name": "get_count",
      "outputs": [
        {
          "internalType": "int256",
          "name": "",
          "type": "int256"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [],
      "name": "get_count_room",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [],
      "name": "get_lastName",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [],
      "name": "get_name",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        }
      ],
      "name": "get_name_room",
      "outputs": [
        {
          "internalType": "string",
          "name": "name",
          "type": "string"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        }
      ],
      "name": "get_numberPeople_room",
      "outputs": [
        {
          "internalType": "int256",
          "name": "numberPeople",
          "type": "int256"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        }
      ],
      "name": "get_openHour_room",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "open_hour",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "hour",
          "type": "uint256"
        }
      ],
      "name": "get_price",
      "outputs": [
        {
          "internalType": "int256",
          "name": "",
          "type": "int256"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [],
      "name": "get_reset_points",
      "outputs": [
        {
          "internalType": "int256",
          "name": "",
          "type": "int256"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [],
      "name": "get_study",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "hour",
          "type": "uint256"
        }
      ],
      "name": "is_free",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "_close_hour",
          "type": "uint256"
        }
      ],
      "name": "set_closeHour_room",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "string",
          "name": "_lastName",
          "type": "string"
        }
      ],
      "name": "set_lastName",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "string",
          "name": "_firstName",
          "type": "string"
        }
      ],
      "name": "set_name",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        },
        {
          "internalType": "string",
          "name": "_name",
          "type": "string"
        }
      ],
      "name": "set_name_room",
      "outputs": [],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        },
        {
          "internalType": "int256",
          "name": "_numberPeople",
          "type": "int256"
        }
      ],
      "name": "set_numberPeople_room",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "_open_hour",
          "type": "uint256"
        }
      ],
      "name": "set_openHour_room",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "string",
          "name": "_study",
          "type": "string"
        }
      ],
      "name": "set_study",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "address",
          "name": "_user",
          "type": "address"
        },
        {
          "internalType": "int256",
          "name": "amount",
          "type": "int256"
        }
      ],
      "name": "sent_points",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "internalType": "uint256",
          "name": "index",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "hour",
          "type": "uint256"
        }
      ],
      "name": "reservate_room",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    }
  ]
        function update_user(web3, address) {
            Coursetro.get_name.call({from: address},
                function (error, result) {
                    if (!error) {
                        var x = document.getElementById("table_profile").rows[1].cells;
                        if (result == 'Not found'){
                            document.getElementById("table_profile").style.display="none";
                        } else{
                            document.getElementById("Form").style.display="none";
                        }
                        x[1].innerHTML = result;
                    } else
                        console.log(error.code)
                });
            Coursetro.get_lastName.call({from: address},
                function (error, result) {
                    if (!error) {
                        var x = document.getElementById("table_profile").rows[2].cells;
                        x[1].innerHTML = result;
                    } else
                        console.log(error.code)
                });
            Coursetro.get_study.call({from: address},
                function (error, result) {
                    if (!error) {
                        var x = document.getElementById("table_profile").rows[3].cells;
                        x[1].innerHTML = result;
                    } else
                        console.log(error.code)
                });
            Coursetro.get_balance.call({from: address},
                function (error, result) {
                    if (!error) {
                        var x = document.getElementById("table_profile").rows[4].cells;
                        x[1].innerHTML = result;
                    } else
                        console.log(error.code)
                });
        }

        function update_rooms() {
            Coursetro.get_count_room.call( {from: address},
                    function (error, result) {
                        if (!error) {
                        for (j = 0; j < result['c'][0]; j++) {

                            result = Coursetro.get_name_room.call(j, {from: address})
                                const div = document.createElement('tr');
                                div.id = j.toString();
                                document.getElementById('ReserveB').appendChild(div);
                                div.innerHTML = '<td>' + result + '</td > <td id="' + j.toString()+ '_ini"> </td> <td id="' + j.toString()+ '_end"></td> ' +
                                    '  <td> ' + j.toString() + '</tr> '
                                document.getElementById('ReserveB').appendChild(div);

                            result = Coursetro.get_openHour_room.call(j, {from: address})

                            hour_open = result['c']['0'];
                            document.getElementById(j.toString()+ '_ini').innerHTML = result['c']['0'].toString() + ":00";


                            result = Coursetro.get_closeHour_room.call(j, {from: address})

                            hour_close = result['c']['0'];
                            document.getElementById(j.toString()+ '_end').innerHTML = result['c']['0'].toString() + ":00";
                        }
                            } else
                                console.log(error.code)

                });
        }

        function button_register() {
          var name = document.getElementById("fname").value;
          var lastName = document.getElementById("fname2").value;
          var study = document.getElementById("fname3").value;
          Coursetro.addPerson(name, lastName, study, {from: address, gasLimit: 6721975},
                function (error, result) {
                    if (!error) {
                       console.log(result)
                    } else
                        console.log(error.code)
                });
          location.reload();
        }

        function button_reserve() {
            var index = document.getElementById("rname1").value;
            var hour = document.getElementById("rname2").value;
            hour = parseInt(hour);
            index = parseInt(index);
            console.log(hour)
            console.log(index)
            Coursetro.reservate_room(index, hour, {from: address, gasLimit: 6721975},
                function (error, result) {
                    if (!error) {
                       console.log(result)
                    } else
                        console.log(error.code)
                });
        }


        // Loading instance
        /*
        let web3 = new Web3(window.ethereum);
        if (typeof web3 !== 'undefined') {
             web3 = new Web3(web3.currentProvider);
        } else {
            console.log('No web3? You should consider trying MetaMask!');
             web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:7545"));
        }
         */
        let web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:7545"));


        var CoursetroContract = web3.eth.contract(abi);
        var Coursetro = CoursetroContract.at("0x39bfF4Fd5F2d52095888642cba60aB179d86cc2b");
        const address = web3.eth.accounts[3];

        setTimeout(function(){ update_user(web3, address);}, 1000);
        update_rooms();



    </script>

<div class="jumbotron text-center" style="margin-bottom:0">
  <p>Footer</p>
</div>

</body>
</html>